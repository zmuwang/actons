!function(a){var e,b="createTouch"in document?"tap":"click",c="action-ajax-loading",d="Server error";a.fn.ajaxAction=function(b){return this.each(function(){new e(a(this),b)})},a.evalData=function(a){if(a)try{return window.eval(a)}catch(b){}},a.isCrossDomain=function(a){if(!/^((http|https)?:)?\/\//.test(a))return!1;var b=window.location,c=b.protocol+"//"+b.host+"/";return a.startsWith("//")&&(a=b.protocol+a),!a.startsWith(c)},a.fn.ajaxAction.defaultOpts={},e=function(a,b){this._init(a,b)},a.extendAction=function(b){a.extend(e.prototype,b)},a.extendAction({_init:function(b,c){var d=this;d.element=b,d.opts=a.extend({},a.fn.ajaxAction.defaultOpts,c),a.extend(d,d.opts.actions||{}),d._ajax()},_ajax:function(){var f,b=this,e={type:b.element.attr("method")||"GET",jsonp:"_callback",cache:!1,url:b.element.attr("data-url")||b.element.attr("href")||b.element.attr("action"),success:function(a){b._action(a)},error:function(a,c,e){var f="";f="parsererror"==c&&"200"==a.status&&"OK"==a.statusText&&""!=a.responseText?a.responseText:{state:503,errorType:c,message:e||d,action:"system"},b._action(f)}};e=a.extend(e,b.opts.ajaxOpts),f=e.url,"GET"!=e.type&&(e.dataType=null),!f||b.element.data(c)||b.element.hasClass("action-ajax-disable")||a.evalData(b.element.attr("data-action-call-before"))===!1||(a.isCrossDomain(f)&&(e.dataType="jsonp"),b.element.data(c,!0),a.ajax(e))},_action:function(b){var d=this,e=d.element.attr("data-action-call-back");d.element.data(c,!1),"string"==typeof b&&(b={action:"string",data:b}),"undefined"!=typeof b&&b.action&&d[b.action]&&(["warn","error"].indexOf(b.action)>=0&&"FORM"==d.element[0].tagName&&d.element.find(".action-fileds-errors").length&&(b={action:"filedsError",data:[{name:"action-fileds-errors",message:b.message||b.data}]}),a.extend(d,b),d[d.action].call(d),e&&a.evalData(e))},_alert:function(b){var c=b||this.message;c=c.replace(/<br\/>/gi,"\n"),alert(c),b&&a.evalData(this.data)},system:function(){this.warn()},info:function(){this._alert()},warn:function(){this._alert()},error:function(){this._alert()},confirm:function(){var b=this.message||d;confirm(b)&&a.evalData(this.data)},filedsError:function(){var f,b=this,c=b.element,d=c.find(".action-fileds-errors"),e=c.find(".action-filed-error");d.length?(d.empty(),a.each(b.data,function(){d.append(this.message).append("<br/>")})):e.length?a.each(b.data,function(){e.filter("[for="+this.name+"]").empty().append(this.message)}):(f="",a.each(b.data,function(){f=f+this.message+"<br/>"}),this._alert(f))},redirect:function(){var a=this.data||this.message||location.href;a&&(window.location.href=a)},topRedirect:function(){var a=this.data||this.message||location.href;a&&(top.location.href=a)},refresh:function(){window.location.reload()},topRefresh:function(){top.location.reload()},render:function(){var b=this;a.each(b.data,function(){a(this.target).html(this.value)})},html:function(){var b=this,c=b.element.attr("data-action-html");c=c?a(c):b.element,c.html(this.data)},string:function(){this.html()},eval:function(){a.evalData(this.data)}}),a(function(){a(".action-ajax-load").each(function(){a(this).ajaxAction({actions:{system:function(){console&&console.log&&console.log("action-ajax-load error")}}})}),a("body").on(b,".action-ajax-click",function(){return a(this).ajaxAction(),!1}),a("body").on("submit",".action-ajax-form",function(){var c=a(this);return c.find(".action-fileds-errors").empty(),c.find(".action-filed-error").empty(),c.ajaxAction({ajaxOpts:{data:c.serialize()}}),!1})})}($);